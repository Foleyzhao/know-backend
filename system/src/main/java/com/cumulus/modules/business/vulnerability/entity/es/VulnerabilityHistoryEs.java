package com.cumulus.modules.business.vulnerability.entity.es;

import com.cumulus.modules.system.entity.User;
import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import org.springframework.data.annotation.Id;
import org.springframework.data.elasticsearch.annotations.Document;
import org.springframework.data.elasticsearch.annotations.Field;
import org.springframework.data.elasticsearch.annotations.FieldType;

import java.io.Serializable;
import java.util.Date;

/**
 * 漏洞历史记录
 *
 * @author : shenjc
 */
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Document(indexName = "vulnerability-history")
public class VulnerabilityHistoryEs implements Serializable {

    private static final long serialVersionUID = 3050355451117456941L;

    /**
     * 排序用字段
     */
    public static final String ORDER_FILED_CREATE_TIME = "createTime";

    /**
     * 处理码 0、发现 1、下发 2、提交复测 3、忽略 4、驳回 5、人工复测 6、扫描复测 7、关闭
     */
    public static final int HANDLE_CODE_NEW = 0;
    public static final int HANDLE_CODE_ISSUED = 1;
    public static final int HANDLE_CODE_SUBMIT_RETEST = 2;
    public static final int HANDLE_CODE_IGNORE = 3;
    public static final int HANDLE_CODE_OVERRULE = 4;
    public static final int HANDLE_CODE_MANUAL_RETEST = 5;
    public static final int HANDLE_CODE_SCAN_RETEST = 6;
    public static final int HANDLE_CODE_CLOSE = 7;
    public static final String HANDLE_CODE_NEW_STR = "新发现";
    public static final String HANDLE_CODE_ISSUED_STR = "下发";
    public static final String HANDLE_CODE_SUBMIT_RETEST_STR = "提交复测";
    public static final String HANDLE_CODE_IGNORE_STR = "忽略";
    public static final String HANDLE_CODE_OVERRULE_STR = "驳回";
    public static final String HANDLE_CODE_MANUAL_RETEST_STR = "人工复测";
    public static final String HANDLE_CODE_SCAN_RETEST_STR = "扫描复测";
    public static final String HANDLE_CODE_CLOSE_STR = "关闭";

    /**
     * ID
     */
    @Id
    private String id;

    /**
     * 漏洞id
     */
    @Field(type = FieldType.Keyword)
    private String vulId;

    /**
     * 操作描述
     */
    @Field(type = FieldType.Keyword)
    private String description;

    /**
     * 处理码  0、发现 1、下发 2、提交复测 3、忽略 4、驳回 5、人工复测 6、扫描复测 7、关闭
     */
    @Field(type = FieldType.Integer)
    private Integer handlingCode;

    /**
     * 创建人的部门名
     */
    @Field(type = FieldType.Keyword)
    private String handleDeptName;

    /**
     * 创建人
     */
    @Field(type = FieldType.Keyword)
    private String createBy;

    /**
     * 更新人
     */
    @Field(type = FieldType.Keyword)
    private String updateBy;

    /**
     * 创建时间
     */
    @Field(type = FieldType.Date)
    private Date createTime;

    /**
     * 更新时间
     */
    @Field(type = FieldType.Date)
    private Date updateTime;

    /**
     * 使用漏洞实体初始化一个 漏洞历史实体
     *
     * @param vulId        漏洞实体
     * @param description  描述
     * @param handlingCode 处理码
     * @param handleUser   处置用户
     */
    public VulnerabilityHistoryEs(String vulId, String description, Integer handlingCode, User handleUser) {
        this.description = description;
        this.vulId = vulId;
        this.handlingCode = handlingCode;
        this.createTime = new Date();
        this.updateTime = new Date();
        if (handleUser != null) {
            this.createBy = handleUser.getUsername();
            this.updateBy = handleUser.getUsername();
            if (handleUser.getDept() != null) {
                this.handleDeptName = handleUser.getDept().getName();
            }
        }
    }
}
