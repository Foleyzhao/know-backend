package com.cumulus.modules.business.vulnerability.dto;

import com.cumulus.modules.business.vulnerability.entity.ScanPlan;
import com.cumulus.modules.business.vulnerability.entity.ScanResult;
import com.cumulus.modules.business.vulnerability.support.VulnerabilityScanProvider;
import lombok.Getter;
import lombok.Setter;

import java.util.HashMap;
import java.util.Map;
import java.util.concurrent.ScheduledFuture;

/**
 * 漏洞扫描请求
 *
 * @author zhaoff
 */
@Getter
@Setter
public class ScanTaskRequest {

    /**
     * 扫描器ID
     */
    private Long scannerId;

    /**
     * 扫描计划id
     */
    private Long planId;

    /**
     * 扫描计划
     */
    private ScanPlan plan;

    /**
     * 扫描结果
     */
    private ScanResult result;

    /**
     * 扫描任务运行的future
     */
    private ScheduledFuture<?> future;

    /**
     * 检测任务执行状态和接收返回结果的future
     */
    private ScheduledFuture<?> statusFuture;

    /**
     * 具体的执行类
     */
    private VulnerabilityScanProvider provider;

    /**
     * 其他信息
     * {
     * "scanner":
     * "":
     * "scanning_tasks": {"assetId": AssetScanResult}
     * }
     */
    private Map<String, Object> extra = new HashMap<>();

    /**
     * 取消正在调度的任务
     */
    public void cancelTask() {
        if (null != future) {
            future.cancel(true);
        }
        if (statusFuture != null) {
            statusFuture.cancel(true);
        }
    }

}
